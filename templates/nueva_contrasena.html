<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nueva contraseña - Alitas El Comelón</title>
  <style>
    body{
      background-color:#f0f0f0;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      margin:0;
    }
    .contenedor{
      background:#fff;
      padding:40px;
      border-radius:15px;
      box-shadow:0px 4px 20px rgba(0,0,0,0.1);
      width:420px;
      text-align:center;
    }
    h2{ margin:0 0 10px 0; color:#333; }

    input{
      width:100%;
      padding:10px;
      margin:10px 0 0 0;
      border-radius:8px;
      border:1px solid #ccc;
      background-color:#eef4ff;
      outline:none;
    }

    button{
      width:100%;
      background-color:#ff7b00;
      color:#fff;
      border:none;
      padding:10px;
      border-radius:8px;
      margin-top:14px;
      cursor:pointer;
      transition:0.3s;
    }
    button:hover{ background-color:#e46b00; }
    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    .alert{
      color:red;
      margin:10px 0 0 0;
      font-size:0.9em;
    }

    .msg{
      font-size:0.85em;
      text-align:left;
      margin-top:6px;
      margin-bottom:0;
    }
    .ok{ color:green; }
    .error{ color:red; }

    a{ color:#ff7b00; text-decoration:none; }
    .links{ margin-top:14px; }
  </style>
</head>
<body>
  <div class="contenedor">
    <h2>Nueva contraseña</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form id="formNuevaPass" method="POST">
      <input id="password" data-validacion="password" type="password" name="password" placeholder="Nueva contraseña" required>
      <div class="msg"></div>

      <input id="confirmar" data-validacion="confirmar" type="password" name="confirmar" placeholder="Confirmar contraseña" required>
      <div id="msgCoinciden" class="msg"></div>

      <button id="btnGuardar" type="submit" disabled>Guardar contraseña</button>
    </form>

    <div class="links">
      <a href="{{ url_for('login') }}">Volver al login</a>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/validaciones.js') }}"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("formNuevaPass");
      const pass = document.getElementById("password");
      const conf = document.getElementById("confirmar");
      const msgCoinciden = document.getElementById("msgCoinciden");
      const btn = document.getElementById("btnGuardar");

      function setMsg(elem, texto, ok){
        if (!elem) return;
        elem.textContent = texto || "";
        elem.className = ok ? "msg ok" : "msg error";
      }

      function validarCoincidencia(){
        const p = (pass.value || "");
        const c = (conf.value || "");

        if (!c){
          setMsg(msgCoinciden, "", true);
          return false;
        }

        if (c === p){
          setMsg(msgCoinciden, "Las contraseñas coinciden ✔", true);
          return true;
        }

        setMsg(msgCoinciden, "Las contraseñas no coinciden ✖", false);
        return false;
      }

      function actualizarBoton(){
        const okPass = (typeof validarPassword === "function") ? validarPassword(pass) : (pass.value.length >= 8);
        const okMatch = validarCoincidencia();
        btn.disabled = !(okPass && okMatch);
      }

      pass.addEventListener("input", () => {
        if (typeof validarPassword === "function") validarPassword(pass);
        validarCoincidencia();
        actualizarBoton();
      });

      conf.addEventListener("input", () => {
        validarCoincidencia();
        actualizarBoton();
      });

      form.addEventListener("submit", (e) => {
        actualizarBoton();
        if (btn.disabled){
          e.preventDefault();
        }
      });

      actualizarBoton();
    });
  </script>
</body>
</html>
